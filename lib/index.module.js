import t,{Component as e}from"react";import r from"prop-types";import n from"react-fast-compare";import i from"invariant";import o from"shallowequal";function a(){return a=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},a.apply(this,arguments)}function s(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,c(t,e)}function c(t,e){return c=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},c(t,e)}function u(t,e){if(null==t)return{};var r,n,i={},o=Object.keys(t);for(n=0;n<o.length;n++)e.indexOf(r=o[n])>=0||(i[r]=t[r]);return i}var l="cssText",p="href",f="innerHTML",h="itemprop",d="rel",m="bodyAttributes",y="htmlAttributes",T={BASE:"base",BODY:"body",HEAD:"head",HTML:"html",LINK:"link",META:"meta",NOSCRIPT:"noscript",SCRIPT:"script",STYLE:"style",TITLE:"title",FRAGMENT:"Symbol(react.fragment)"},g={rel:["amphtml","canonical","alternate"]},v={type:["application/ld+json"]},b={charset:"",name:["generator","robots","description"],property:["og:type","og:title","og:url","og:image","og:image:alt","og:description","twitter:url","twitter:title","twitter:description","twitter:image","twitter:image:alt","twitter:card","twitter:site"]},A=Object.keys(T).map(function(t){return T[t]}),C={accesskey:"accessKey",charset:"charSet",class:"className",contenteditable:"contentEditable",contextmenu:"contextMenu","http-equiv":"httpEquiv",itemprop:"itemProp",tabindex:"tabIndex"},O=Object.keys(C).reduce(function(t,e){return t[C[e]]=e,t},{}),S="data-rh",w=/*#__PURE__*/function(){function t(t,e){this.cacheName="meta-manager-cache",this.client=t?caches:null,this.authToken=e}var e=t.prototype;return e.getTTl=function(){return(new Date).getTime()+6048e5},e.shouldRefresh=function(t){return"number"!=typeof t||(new Date).getTime()>t},e.get=function(t,e){void 0===e&&(e=!1);try{var r=this;return Promise.resolve(e||!r.client?r.fetch(t):function(e,n){try{var i=Promise.resolve(r.client.open(r.cacheName)).then(function(e){return function(){if(e)return Promise.resolve(e.match(t).catch(function(t){return console.error(t)})).then(function(e){return e?Promise.resolve(e.json()).then(function(e){return r.shouldRefresh(e.ttl)?r.fetch(t):e}):r.fetch(t)})}()})}catch(t){return}return i&&i.then?i.then(void 0,function(){}):i}())}catch(t){return Promise.reject(t)}},e.set=function(t,e){try{var r=this;return Promise.resolve(r.client.open(r.cacheName)).then(function(n){return Promise.resolve(n.put(t,new Response(H(a({},e,{ttl:r.getTTl()})),{headers:{"Cache-Control":"max-age=10"}})).then(function(e){return r.get(t)}))})}catch(t){return Promise.reject(t)}},e.fetch=function(t){try{var e=this,r=(null!=t?t:" __mm__ ").split("__mm__");return Promise.resolve(q({url:"https://api.metamanager.io/website/v1/websites/"+r[0]+"/pixel?url="+r[1],requestBody:{method:"GET",headers:{Authorization:"Bearer "+e.authToken}}}).then(function(t){return t.json()}).then(function(r){var n=null==r?void 0:r.item;if(n)return e.client?e.set(t,n):n}).catch(function(t){return null}).finally(function(t){return!1}))}catch(t){return Promise.reject(t)}},t}(),P=function(t,e){for(var r=t.length-1;r>=0;r-=1){var n=t[r];if(Object.prototype.hasOwnProperty.call(n,e))return n[e]}return null},E=function(t){var e=P(t,T.TITLE),r=P(t,"titleTemplate");if(Array.isArray(e)&&(e=e.join("")),r&&e)return r.replace(/%s/g,function(){return e});var n=P(t,"defaultTitle");return e||n||void 0},I=function(t){return P(t,"onChangeClientState")||function(){}},j=function(t,e){return e.filter(function(e){return void 0!==e[t]}).map(function(e){return e[t]}).reduce(function(t,e){return a({},t,e)},{})},x=function(t,e){return e.filter(function(t){return void 0!==t[T.BASE]}).map(function(t){return t[T.BASE]}).reverse().reduce(function(e,r){if(!e.length)for(var n=Object.keys(r),i=0;i<n.length;i+=1){var o=n[i].toLowerCase();if(-1!==t.indexOf(o)&&r[o])return e.concat(r)}return e},[])},k=function(t,e,r){var n={};return r.filter(function(e){return!!Array.isArray(e[t])||(void 0!==e[t]&&console&&"function"==typeof console.warn&&console.warn("Helmet: "+t+' should be of type "Array". Instead found type "'+typeof e[t]+'"'),!1)}).map(function(e){return e[t]}).reverse().reduce(function(t,r){var i={};r.filter(function(t){for(var r,o=Object.keys(t),a=0;a<o.length;a+=1){var s=o[a],c=s.toLowerCase();-1===e.indexOf(c)||r===d&&"canonical"===t[r].toLowerCase()||c===d&&"stylesheet"===t[c].toLowerCase()||(r=c),-1===e.indexOf(s)||s!==f&&s!==l&&s!==h||(r=s)}if(!r||!t[r])return!1;var u=t[r].toLowerCase();return n[r]||(n[r]={}),i[r]||(i[r]={}),!n[r][u]&&(i[r][u]=!0,!0)}).reverse().forEach(function(e){return t.push(e)});for(var o=Object.keys(i),s=0;s<o.length;s+=1){var c=o[s],u=a({},n[c],i[c]);n[c]=u}return t},[]).reverse()},L=function(t,e){if(Array.isArray(t)&&t.length)for(var r=0;r<t.length;r+=1)if(t[r][e])return!0;return!1},D=function(t){return Array.isArray(t)?t.join(""):t},M=function(t,e){return Array.isArray(t)?t.reduce(function(t,r){return function(t,e){for(var r=Object.keys(t),n=0;n<r.length;n+=1)if(e[r[n]]&&e[r[n]].includes(t[r[n]]))return!0;return!1}(r,e)?t.priority.push(r):t.default.push(r),t},{priority:[],default:[]}):{default:t}},N=function(t,e){var r;return a({},t,((r={})[e]=void 0,r))},R=function(t){try{return JSON.parse(t)}catch(e){return t}},H=function(t){if("string"==typeof t)return t;try{return JSON.stringify(t)}catch(e){return t}},_=function(t,e,r){var n,i,o,a,s,c;switch(t){case"title":return null!=(n=null==(i=e.meta)||null==(o=i.tag)?void 0:o.title)?n:r;case"description":return null!=(a=null==(s=e.meta)||null==(c=s.tag)?void 0:c.description)?a:r;default:return r}},q=function(t){return fetch(t.url,t.requestBody)},U=[T.NOSCRIPT,T.SCRIPT,T.STYLE],B=function(t,e){return void 0===e&&(e=!0),!1===e?String(t):String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;")},Y=function(t){return Object.keys(t).reduce(function(e,r){var n=void 0!==t[r]?r+'="'+t[r]+'"':""+r;return e?e+" "+n:n},"")},K=function(t,e){return void 0===e&&(e={}),Object.keys(t).reduce(function(e,r){return e[C[r]||r]=t[r],e},e)},z=function(e,r){return r.map(function(r,n){var i,o=((i={key:n})[S]=!0,i);return Object.keys(r).forEach(function(t){var e=C[t]||t;e===f||e===l?o.dangerouslySetInnerHTML={__html:r.innerHTML||r.cssText}:o[e]=r[t]}),t.createElement(e,o)})},F=function(e,r,n){switch(e){case T.TITLE:return{toComponent:function(){return n=r.titleAttributes,(i={key:e=r.title})[S]=!0,o=K(n,i),[t.createElement(T.TITLE,o,e)];var e,n,i,o},toString:function(){return function(t,e,r,n){var i=Y(r),o=D(e);return i?"<"+t+" "+S+'="true" '+i+">"+B(o,n)+"</"+t+">":"<"+t+" "+S+'="true">'+B(o,n)+"</"+t+">"}(e,r.title,r.titleAttributes,n)}};case m:case y:return{toComponent:function(){return K(r)},toString:function(){return Y(r)}};default:return{toComponent:function(){return z(e,r)},toString:function(){return function(t,e,r){return e.reduce(function(e,n){var i=Object.keys(n).filter(function(t){return!(t===f||t===l)}).reduce(function(t,e){var i=void 0===n[e]?e:e+'="'+B(n[e],r)+'"';return t?t+" "+i:i},""),o=n.innerHTML||n.cssText||"",a=-1===U.indexOf(t);return e+"<"+t+" "+S+'="true" '+i+(a?"/>":">"+o+"</"+t+">")},"")}(e,r,n)}}}},G=function(t){var e=t.baseTag,r=t.bodyAttributes,n=t.encode,i=t.htmlAttributes,o=t.noscriptTags,a=t.styleTags,s=t.title,c=void 0===s?"":s,u=t.titleAttributes,l=t.linkTags,p=t.metaTags,f=t.scriptTags,h={toComponent:function(){},toString:function(){return""}};if(t.prioritizeSeoTags){var d=function(t){var e=t.linkTags,r=t.scriptTags,n=t.encode,i=M(t.metaTags,b),o=M(e,g),a=M(r,v);return{priorityMethods:{toComponent:function(){return[].concat(z(T.META,i.priority),z(T.LINK,o.priority),z(T.SCRIPT,a.priority))},toString:function(){return F(T.META,i.priority,n)+" "+F(T.LINK,o.priority,n)+" "+F(T.SCRIPT,a.priority,n)}},metaTags:i.default,linkTags:o.default,scriptTags:a.default}}(t);h=d.priorityMethods,l=d.linkTags,p=d.metaTags,f=d.scriptTags}return{priority:h,base:F(T.BASE,e,n),bodyAttributes:F(m,r,n),htmlAttributes:F(y,i,n),link:F(T.LINK,l,n),meta:F(T.META,p,n),noscript:F(T.NOSCRIPT,o,n),script:F(T.SCRIPT,f,n),style:F(T.STYLE,a,n),title:F(T.TITLE,{title:c,titleAttributes:u},n)}},J=[],W=function(t,e,r,n){var i=this;void 0===e&&(e="undefined"!=typeof document),this.instances=[],this.value={setApiData:function(t){i.context.apiData=t},setHelmet:function(t){i.context.helmet=t},helmetInstances:{get:function(){return i.canUseDOM?J:i.instances},add:function(t){(i.canUseDOM?J:i.instances).push(t)},remove:function(t){var e=(i.canUseDOM?J:i.instances).indexOf(t);(i.canUseDOM?J:i.instances).splice(e,1)}}},this.context=t,this.webSiteId=r,this.authToken=n,this.canUseDOM=e,e||(t.helmet=G({baseTag:[],bodyAttributes:{},encodeSpecialCharacters:!0,htmlAttributes:{},linkTags:[],metaTags:[],noscriptTags:[],scriptTags:[],styleTags:[],title:"",titleAttributes:{}}))},Q=t.createContext({}),V=r.shape({setApiData:r.func,setHelmet:r.func,helmetInstances:r.shape({get:r.func,add:r.func,remove:r.func})}),X="undefined"!=typeof document,Z=/*#__PURE__*/function(e){function r(t){var n;return(n=e.call(this,t)||this).helmetData=new W(n.props.context,r.canUseDOM,n.props.webSiteId,n.props.authToken),n}return s(r,e),r.prototype.render=function(){/*#__PURE__*/return t.createElement(Q.Provider,{value:a({},this.helmetData.value,{webSiteId:this.helmetData.webSiteId,authToken:this.helmetData.authToken})},this.props.children)},r}(e);Z.canUseDOM=X,Z.propTypes={apiData:r.any,context:r.shape({helmet:r.shape()}),webSiteId:r.number.isRequired,authToken:r.string.isRequired,children:r.node.isRequired},Z.defaultProps={context:{}},Z.displayName="HelmetProvider";var $=function(t,e){var r,n=document.head||document.querySelector(T.HEAD),i=n.querySelectorAll(t+"["+S+"]"),o=[].slice.call(i),a=[];return e&&e.length&&e.forEach(function(e){var n=document.createElement(t);for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(i===f?n.innerHTML=e.innerHTML:i===l?n.styleSheet?n.styleSheet.cssText=e.cssText:n.appendChild(document.createTextNode(e.cssText)):n.setAttribute(i,void 0===e[i]?"":e[i]));n.setAttribute(S,"true"),o.some(function(t,e){return r=e,n.isEqualNode(t)})?o.splice(r,1):a.push(n)}),o.forEach(function(t){return t.parentNode.removeChild(t)}),a.forEach(function(t){return n.appendChild(t)}),{oldTags:o,newTags:a}},tt=function(t,e){var r=document.getElementsByTagName(t)[0];if(r){for(var n=r.getAttribute(S),i=n?n.split(","):[],o=[].concat(i),a=Object.keys(e),s=0;s<a.length;s+=1){var c=a[s],u=e[c]||"";r.getAttribute(c)!==u&&r.setAttribute(c,u),-1===i.indexOf(c)&&i.push(c);var l=o.indexOf(c);-1!==l&&o.splice(l,1)}for(var p=o.length-1;p>=0;p-=1)r.removeAttribute(o[p]);i.length===o.length?r.removeAttribute(S):r.getAttribute(S)!==a.join(",")&&r.setAttribute(S,a.join(","))}},et=function(t,e){var r=t.baseTag,n=t.htmlAttributes,i=t.linkTags,o=t.metaTags,a=t.noscriptTags,s=t.onChangeClientState,c=t.scriptTags,u=t.styleTags,l=t.title,p=t.titleAttributes;tt(T.BODY,t.bodyAttributes),tt(T.HTML,n),function(t,e){void 0!==t&&document.title!==t&&(document.title=D(t)),tt(T.TITLE,e)}(l,p);var f={baseTag:$(T.BASE,r),linkTags:$(T.LINK,i),metaTags:$(T.META,o),noscriptTags:$(T.NOSCRIPT,a),scriptTags:$(T.SCRIPT,c),styleTags:$(T.STYLE,u)},h={},d={};Object.keys(f).forEach(function(t){var e=f[t],r=e.newTags,n=e.oldTags;r.length&&(h[t]=r),n.length&&(d[t]=f[t].oldTags)}),e&&e(),s(t,h,d)},rt=null,nt=[{name:"description",content:""}],it=/*#__PURE__*/function(t){function e(){for(var e,r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];return(e=t.call.apply(t,[this].concat(n))||this).rendered=!1,e}s(e,t);var r=e.prototype;return r.shouldComponentUpdate=function(t){return!o(t,this.props)},r.componentDidUpdate=function(){this.emitChange()},r.componentWillUnmount=function(){this.props.context.helmetInstances.remove(this),this.emitChange()},r.syncMeta=function(t,e){var r,n;if(!e)return t;var i=t;return i.title=_("title",e,t.title),i.metaTags=null==(r=(null==(n=t.metaTags)?void 0:n.length)>0?t.metaTags:nt)?void 0:r.map(function(t){return a({},t,{content:_(t.name,e,t.content)})}),i.scriptTags=[].concat(t.scriptTags,function(t){var e=null==t?void 0:t.schema;return e?[{innerHTML:H(R(e)),type:"application/ld+json"}]:[]}(e)),i},r.updateHelmet=function(t){var e,r=null,n=this.props.context.setHelmet;Z.canUseDOM?(e=t,rt&&cancelAnimationFrame(rt),e.defer?rt=requestAnimationFrame(function(){et(e,function(){rt=null})}):(et(e),rt=null)):G&&(r=G(t)),n(r)},r.emitChange=function(){var t,e=this,r=this.props.context,n=r.setApiData,i=(t=r.helmetInstances.get().map(function(t){var e=a({},t.props);return delete e.context,e}),{baseTag:x([p],t),bodyAttributes:j(m,t),defer:P(t,"defer"),encode:P(t,"encodeSpecialCharacters"),htmlAttributes:j(y,t),linkTags:k(T.LINK,[d,p],t),metaTags:k(T.META,["name","charset","http-equiv","property",h],t),noscriptTags:k(T.NOSCRIPT,[f],t),onChangeClientState:I(t),scriptTags:k(T.SCRIPT,["src",f],t),styleTags:k(T.STYLE,[l],t),title:E(t),titleAttributes:j("titleAttributes",t),prioritizeSeoTags:L(t,"prioritizeSeoTags")});this.props.context.webSiteId&&!this.props.context.apiData?function(t,e,r,n){try{var i=new w(e,n);return Promise.resolve(i.get(t+"__mm__"+r))}catch(t){return Promise.reject(t)}}(this.props.context.webSiteId,Z.canUseDOM,this.props.path,this.props.context.authToken).then(function(t){if(t){n(t);var r=e.syncMeta(i,t);e.updateHelmet(r)}else e.updateHelmet(i)}).catch(function(t){return console.error(t)}):this.updateHelmet(i)},r.init=function(){this.rendered||(this.rendered=!0,this.props.context.helmetInstances.add(this),this.emitChange())},r.render=function(){return this.init(),null},e}(e);it.propTypes={context:V.isRequired},it.displayName="HelmetDispatcher";var ot=["children"],at=["children"],st=/*#__PURE__*/function(e){function r(){var t;return(t=e.call(this)||this).state={},t}s(r,e);var o=r.prototype;return o.shouldComponentUpdate=function(t){return!n(N(this.props,"helmetData"),N(t,"helmetData"))},o.mapNestedChildrenToProps=function(t,e){if(!e)return null;switch(t.type){case T.SCRIPT:case T.NOSCRIPT:return{innerHTML:e};case T.STYLE:return{cssText:e};default:throw new Error("<"+t.type+" /> elements are self-closing and can not contain children. Refer to our API for more information.")}},o.flattenArrayTypeChildren=function(t){var e,r=t.child,n=t.arrayTypeChildren;return a({},n,((e={})[r.type]=[].concat(n[r.type]||[],[a({},t.newChildProps,this.mapNestedChildrenToProps(r,t.nestedChildren))]),e))},o.mapObjectTypeChildren=function(t){var e,r,n=t.child,i=t.newProps,o=t.newChildProps,s=t.nestedChildren;switch(n.type){case T.TITLE:return a({},i,((e={})[n.type]=s,e.titleAttributes=a({},o),e));case T.BODY:return a({},i,{bodyAttributes:a({},o)});case T.HTML:return a({},i,{htmlAttributes:a({},o)});default:return a({},i,((r={})[n.type]=a({},o),r))}},o.mapArrayTypeChildrenToProps=function(t,e){var r=a({},e);return Object.keys(t).forEach(function(e){var n;r=a({},r,((n={})[e]=t[e],n))}),r},o.warnOnInvalidChildren=function(t,e){return i(A.some(function(e){return t.type===e}),"function"==typeof t.type?"You may be attempting to nest <Helmet> components within each other, which is not allowed. Refer to our API for more information.":"Only elements types "+A.join(", ")+" are allowed. Helmet does not support rendering <"+t.type+"> elements. Refer to our API for more information."),i(!e||"string"==typeof e||Array.isArray(e)&&!e.some(function(t){return"string"!=typeof t}),"Helmet expects a string as a child of <"+t.type+">. Did you forget to wrap your children in braces? ( <"+t.type+">{``}</"+t.type+"> ) Refer to our API for more information."),!0},o.mapChildrenToProps=function(e,r){var n=this,i={};return t.Children.forEach(e,function(t){if(t&&t.props){var e=t.props,o=e.children,a=u(e,ot),s=Object.keys(a).reduce(function(t,e){return t[O[e]||e]=a[e],t},{}),c=t.type;switch("symbol"==typeof c?c=c.toString():n.warnOnInvalidChildren(t,o),c){case T.FRAGMENT:r=n.mapChildrenToProps(o,r);break;case T.LINK:case T.META:case T.NOSCRIPT:case T.SCRIPT:case T.STYLE:i=n.flattenArrayTypeChildren({child:t,arrayTypeChildren:i,newChildProps:s,nestedChildren:o});break;default:r=n.mapObjectTypeChildren({child:t,newProps:r,newChildProps:s,nestedChildren:o})}}}),this.mapArrayTypeChildrenToProps(i,r)},o.mapDataToApi=function(t){var e,r;return a({},t,{title:null!=(e=null==(r=this.state.apiData)?void 0:r.meta.tag.title)?e:t.title})},o.render=function(){var e=this.props,r=e.children,n=u(e,at),i=a({},n),o=n.helmetData;return r&&(i=this.mapChildrenToProps(r,i)),!o||o instanceof W||(o=new W(o.context,o.instances)),o?/*#__PURE__*/t.createElement(it,a({},i,{context:o.value,helmetData:void 0})):/*#__PURE__*/t.createElement(Q.Consumer,null,function(e){/*#__PURE__*/return t.createElement(it,a({},i,{context:e}))})},r}(e);st.propTypes={base:r.object,bodyAttributes:r.object,children:r.oneOfType([r.arrayOf(r.node),r.node]),defaultTitle:r.string,defer:r.bool,encodeSpecialCharacters:r.bool,htmlAttributes:r.object,link:r.arrayOf(r.object),meta:r.arrayOf(r.object),noscript:r.arrayOf(r.object),onChangeClientState:r.func,script:r.arrayOf(r.object),style:r.arrayOf(r.object),title:r.string,titleAttributes:r.object,titleTemplate:r.string,prioritizeSeoTags:r.bool,helmetData:r.object},st.defaultProps={defer:!0,encodeSpecialCharacters:!0,prioritizeSeoTags:!1},st.displayName="Helmet";export{st as Helmet,W as HelmetData,Z as HelmetProvider};
//# sourceMappingURL=index.module.js.map
