!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("react"),require("prop-types"),require("react-fast-compare"),require("invariant"),require("shallowequal")):"function"==typeof define&&define.amd?define(["exports","react","prop-types","react-fast-compare","invariant","shallowequal"],e):e((t||self).reactMetamanagerPlugin={},t.react,t.propTypes,t.reactFastCompare,t.invariant,t.shallowequal)}(this,function(t,e,r,n,i,a){function o(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var u=/*#__PURE__*/o(e),s=/*#__PURE__*/o(r),c=/*#__PURE__*/o(n),l=/*#__PURE__*/o(i),f=/*#__PURE__*/o(a);function p(){return p=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},p.apply(this,arguments)}function d(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,h(t,e)}function h(t,e){return h=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},h(t,e)}function m(t,e){if(null==t)return{};var r,n,i={},a=Object.keys(t);for(n=0;n<a.length;n++)e.indexOf(r=a[n])>=0||(i[r]=t[r]);return i}var y="cssText",T="href",g="innerHTML",v="itemprop",b="rel",A="bodyAttributes",C="htmlAttributes",O={BASE:"base",BODY:"body",HEAD:"head",HTML:"html",LINK:"link",META:"meta",NOSCRIPT:"noscript",SCRIPT:"script",STYLE:"style",TITLE:"title",FRAGMENT:"Symbol(react.fragment)"},S={rel:["amphtml","canonical","alternate"]},w={type:["application/ld+json"]},P={charset:"",name:["generator","robots","description"],property:["og:type","og:title","og:url","og:image","og:image:alt","og:description","twitter:url","twitter:title","twitter:description","twitter:image","twitter:image:alt","twitter:card","twitter:site"]},E=Object.keys(O).map(function(t){return O[t]}),I={accesskey:"accessKey",charset:"charSet",class:"className",contenteditable:"contentEditable",contextmenu:"contextMenu","http-equiv":"httpEquiv",itemprop:"itemProp",tabindex:"tabIndex"},j=Object.keys(I).reduce(function(t,e){return t[I[e]]=e,t},{}),x="data-rh",k=/*#__PURE__*/function(){function t(t,e){this.cacheName="meta-manager-cache",this.client=t?caches:null,this.authToken=e}var e=t.prototype;return e.getTTl=function(){return(new Date).getTime()+6048e5},e.shouldRefresh=function(t){return"number"!=typeof t||(new Date).getTime()>t},e.get=function(t,e){void 0===e&&(e=!1);try{var r=this;return Promise.resolve(e||!r.client?r.fetch(t):function(e,n){try{var i=Promise.resolve(r.client.open(r.cacheName)).then(function(e){return function(){if(e)return Promise.resolve(e.match(t).catch(function(t){return console.error(t)})).then(function(e){return e?Promise.resolve(e.json()).then(function(e){return r.shouldRefresh(e.ttl)?r.fetch(t):e}):r.fetch(t)})}()})}catch(t){return}return i&&i.then?i.then(void 0,function(){}):i}())}catch(t){return Promise.reject(t)}},e.set=function(t,e){try{var r=this;return Promise.resolve(r.client.open(r.cacheName)).then(function(n){return Promise.resolve(n.put(t,new Response(K(p({},e,{ttl:r.getTTl()})),{headers:{"Cache-Control":"max-age=10"}})).then(function(e){return r.get(t)}))})}catch(t){return Promise.reject(t)}},e.fetch=function(t){try{var e=this,r=(null!=t?t:" __mm__ ").split("__mm__");return Promise.resolve(F({url:"https://api.metamanager.io/website/v1/websites/"+r[0]+"/pixel?url="+r[1],requestBody:{method:"GET",headers:{Authorization:"Bearer "+e.authToken}}}).then(function(t){return t.json()}).then(function(r){var n=null==r?void 0:r.item;if(n)return e.client?e.set(t,n):n}).catch(function(t){return null}).finally(function(t){return!1}))}catch(t){return Promise.reject(t)}},t}(),D=function(t,e){for(var r=t.length-1;r>=0;r-=1){var n=t[r];if(Object.prototype.hasOwnProperty.call(n,e))return n[e]}return null},L=function(t){var e=D(t,O.TITLE),r=D(t,"titleTemplate");if(Array.isArray(e)&&(e=e.join("")),r&&e)return r.replace(/%s/g,function(){return e});var n=D(t,"defaultTitle");return e||n||void 0},M=function(t){return D(t,"onChangeClientState")||function(){}},N=function(t,e){return e.filter(function(e){return void 0!==e[t]}).map(function(e){return e[t]}).reduce(function(t,e){return p({},t,e)},{})},H=function(t,e){return e.filter(function(t){return void 0!==t[O.BASE]}).map(function(t){return t[O.BASE]}).reverse().reduce(function(e,r){if(!e.length)for(var n=Object.keys(r),i=0;i<n.length;i+=1){var a=n[i].toLowerCase();if(-1!==t.indexOf(a)&&r[a])return e.concat(r)}return e},[])},R=function(t,e,r){var n={};return r.filter(function(e){return!!Array.isArray(e[t])||(void 0!==e[t]&&console&&"function"==typeof console.warn&&console.warn("Helmet: "+t+' should be of type "Array". Instead found type "'+typeof e[t]+'"'),!1)}).map(function(e){return e[t]}).reverse().reduce(function(t,r){var i={};r.filter(function(t){for(var r,a=Object.keys(t),o=0;o<a.length;o+=1){var u=a[o],s=u.toLowerCase();-1===e.indexOf(s)||r===b&&"canonical"===t[r].toLowerCase()||s===b&&"stylesheet"===t[s].toLowerCase()||(r=s),-1===e.indexOf(u)||u!==g&&u!==y&&u!==v||(r=u)}if(!r||!t[r])return!1;var c=t[r].toLowerCase();return n[r]||(n[r]={}),i[r]||(i[r]={}),!n[r][c]&&(i[r][c]=!0,!0)}).reverse().forEach(function(e){return t.push(e)});for(var a=Object.keys(i),o=0;o<a.length;o+=1){var u=a[o],s=p({},n[u],i[u]);n[u]=s}return t},[]).reverse()},q=function(t,e){if(Array.isArray(t)&&t.length)for(var r=0;r<t.length;r+=1)if(t[r][e])return!0;return!1},_=function(t){return Array.isArray(t)?t.join(""):t},U=function(t,e){return Array.isArray(t)?t.reduce(function(t,r){return function(t,e){for(var r=Object.keys(t),n=0;n<r.length;n+=1)if(e[r[n]]&&e[r[n]].includes(t[r[n]]))return!0;return!1}(r,e)?t.priority.push(r):t.default.push(r),t},{priority:[],default:[]}):{default:t}},B=function(t,e){var r;return p({},t,((r={})[e]=void 0,r))},Y=function(t){try{return JSON.parse(t)}catch(e){return t}},K=function(t){if("string"==typeof t)return t;try{return JSON.stringify(t)}catch(e){return t}},z=function(t,e,r){var n,i,a,o,u,s;switch(t){case"title":return null!=(n=null==(i=e.meta)||null==(a=i.tag)?void 0:a.title)?n:r;case"description":return null!=(o=null==(u=e.meta)||null==(s=u.tag)?void 0:s.description)?o:r;default:return r}},F=function(t){return fetch(t.url,t.requestBody)},G=[O.NOSCRIPT,O.SCRIPT,O.STYLE],J=function(t,e){return void 0===e&&(e=!0),!1===e?String(t):String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;")},W=function(t){return Object.keys(t).reduce(function(e,r){var n=void 0!==t[r]?r+'="'+t[r]+'"':""+r;return e?e+" "+n:n},"")},Q=function(t,e){return void 0===e&&(e={}),Object.keys(t).reduce(function(e,r){return e[I[r]||r]=t[r],e},e)},V=function(t,e){return e.map(function(e,r){var n,i=((n={key:r})[x]=!0,n);return Object.keys(e).forEach(function(t){var r=I[t]||t;r===g||r===y?i.dangerouslySetInnerHTML={__html:e.innerHTML||e.cssText}:i[r]=e[t]}),u.default.createElement(t,i)})},X=function(t,e,r){switch(t){case O.TITLE:return{toComponent:function(){return r=e.titleAttributes,(n={key:t=e.title})[x]=!0,i=Q(r,n),[u.default.createElement(O.TITLE,i,t)];var t,r,n,i},toString:function(){return function(t,e,r,n){var i=W(r),a=_(e);return i?"<"+t+" "+x+'="true" '+i+">"+J(a,n)+"</"+t+">":"<"+t+" "+x+'="true">'+J(a,n)+"</"+t+">"}(t,e.title,e.titleAttributes,r)}};case A:case C:return{toComponent:function(){return Q(e)},toString:function(){return W(e)}};default:return{toComponent:function(){return V(t,e)},toString:function(){return function(t,e,r){return e.reduce(function(e,n){var i=Object.keys(n).filter(function(t){return!(t===g||t===y)}).reduce(function(t,e){var i=void 0===n[e]?e:e+'="'+J(n[e],r)+'"';return t?t+" "+i:i},""),a=n.innerHTML||n.cssText||"",o=-1===G.indexOf(t);return e+"<"+t+" "+x+'="true" '+i+(o?"/>":">"+a+"</"+t+">")},"")}(t,e,r)}}}},Z=function(t){var e=t.baseTag,r=t.bodyAttributes,n=t.encode,i=t.htmlAttributes,a=t.noscriptTags,o=t.styleTags,u=t.title,s=void 0===u?"":u,c=t.titleAttributes,l=t.linkTags,f=t.metaTags,p=t.scriptTags,d={toComponent:function(){},toString:function(){return""}};if(t.prioritizeSeoTags){var h=function(t){var e=t.linkTags,r=t.scriptTags,n=t.encode,i=U(t.metaTags,P),a=U(e,S),o=U(r,w);return{priorityMethods:{toComponent:function(){return[].concat(V(O.META,i.priority),V(O.LINK,a.priority),V(O.SCRIPT,o.priority))},toString:function(){return X(O.META,i.priority,n)+" "+X(O.LINK,a.priority,n)+" "+X(O.SCRIPT,o.priority,n)}},metaTags:i.default,linkTags:a.default,scriptTags:o.default}}(t);d=h.priorityMethods,l=h.linkTags,f=h.metaTags,p=h.scriptTags}return{priority:d,base:X(O.BASE,e,n),bodyAttributes:X(A,r,n),htmlAttributes:X(C,i,n),link:X(O.LINK,l,n),meta:X(O.META,f,n),noscript:X(O.NOSCRIPT,a,n),script:X(O.SCRIPT,p,n),style:X(O.STYLE,o,n),title:X(O.TITLE,{title:s,titleAttributes:c},n)}},$=[],tt=function(t,e,r,n){var i=this;void 0===e&&(e="undefined"!=typeof document),this.instances=[],this.value={setApiData:function(t){i.context.apiData=t},setHelmet:function(t){i.context.helmet=t},helmetInstances:{get:function(){return i.canUseDOM?$:i.instances},add:function(t){(i.canUseDOM?$:i.instances).push(t)},remove:function(t){var e=(i.canUseDOM?$:i.instances).indexOf(t);(i.canUseDOM?$:i.instances).splice(e,1)}}},this.context=t,this.webSiteId=r,this.authToken=n,this.canUseDOM=e,e||(t.helmet=Z({baseTag:[],bodyAttributes:{},encodeSpecialCharacters:!0,htmlAttributes:{},linkTags:[],metaTags:[],noscriptTags:[],scriptTags:[],styleTags:[],title:"",titleAttributes:{}}))},et=u.default.createContext({}),rt=s.default.shape({setApiData:s.default.func,setHelmet:s.default.func,helmetInstances:s.default.shape({get:s.default.func,add:s.default.func,remove:s.default.func})}),nt="undefined"!=typeof document,it=/*#__PURE__*/function(t){function e(r){var n;return(n=t.call(this,r)||this).helmetData=new tt(n.props.context,e.canUseDOM,n.props.webSiteId,n.props.authToken),n}return d(e,t),e.prototype.render=function(){/*#__PURE__*/return u.default.createElement(et.Provider,{value:p({},this.helmetData.value,{webSiteId:this.helmetData.webSiteId,authToken:this.helmetData.authToken})},this.props.children)},e}(e.Component);it.canUseDOM=nt,it.propTypes={apiData:s.default.any,context:s.default.shape({helmet:s.default.shape()}),webSiteId:s.default.number.isRequired,authToken:s.default.string.isRequired,children:s.default.node.isRequired},it.defaultProps={context:{}},it.displayName="HelmetProvider";var at=function(t,e){var r,n=document.head||document.querySelector(O.HEAD),i=n.querySelectorAll(t+"["+x+"]"),a=[].slice.call(i),o=[];return e&&e.length&&e.forEach(function(e){var n=document.createElement(t);for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(i===g?n.innerHTML=e.innerHTML:i===y?n.styleSheet?n.styleSheet.cssText=e.cssText:n.appendChild(document.createTextNode(e.cssText)):n.setAttribute(i,void 0===e[i]?"":e[i]));n.setAttribute(x,"true"),a.some(function(t,e){return r=e,n.isEqualNode(t)})?a.splice(r,1):o.push(n)}),a.forEach(function(t){return t.parentNode.removeChild(t)}),o.forEach(function(t){return n.appendChild(t)}),{oldTags:a,newTags:o}},ot=function(t,e){var r=document.getElementsByTagName(t)[0];if(r){for(var n=r.getAttribute(x),i=n?n.split(","):[],a=[].concat(i),o=Object.keys(e),u=0;u<o.length;u+=1){var s=o[u],c=e[s]||"";r.getAttribute(s)!==c&&r.setAttribute(s,c),-1===i.indexOf(s)&&i.push(s);var l=a.indexOf(s);-1!==l&&a.splice(l,1)}for(var f=a.length-1;f>=0;f-=1)r.removeAttribute(a[f]);i.length===a.length?r.removeAttribute(x):r.getAttribute(x)!==o.join(",")&&r.setAttribute(x,o.join(","))}},ut=function(t,e){var r=t.baseTag,n=t.htmlAttributes,i=t.linkTags,a=t.metaTags,o=t.noscriptTags,u=t.onChangeClientState,s=t.scriptTags,c=t.styleTags,l=t.title,f=t.titleAttributes;ot(O.BODY,t.bodyAttributes),ot(O.HTML,n),function(t,e){void 0!==t&&document.title!==t&&(document.title=_(t)),ot(O.TITLE,e)}(l,f);var p={baseTag:at(O.BASE,r),linkTags:at(O.LINK,i),metaTags:at(O.META,a),noscriptTags:at(O.NOSCRIPT,o),scriptTags:at(O.SCRIPT,s),styleTags:at(O.STYLE,c)},d={},h={};Object.keys(p).forEach(function(t){var e=p[t],r=e.newTags,n=e.oldTags;r.length&&(d[t]=r),n.length&&(h[t]=p[t].oldTags)}),e&&e(),u(t,d,h)},st=null,ct=[{name:"description",content:""}],lt=/*#__PURE__*/function(t){function e(){for(var e,r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];return(e=t.call.apply(t,[this].concat(n))||this).rendered=!1,e}d(e,t);var r=e.prototype;return r.shouldComponentUpdate=function(t){return!f.default(t,this.props)},r.componentDidUpdate=function(){this.emitChange()},r.componentWillUnmount=function(){this.props.context.helmetInstances.remove(this),this.emitChange()},r.syncMeta=function(t,e){var r,n;if(!e)return t;var i=t;return i.title=z("title",e,t.title),i.metaTags=null==(r=(null==(n=t.metaTags)?void 0:n.length)>0?t.metaTags:ct)?void 0:r.map(function(t){return p({},t,{content:z(t.name,e,t.content)})}),i.scriptTags=[].concat(t.scriptTags,function(t){var e=null==t?void 0:t.schema;return e?[{innerHTML:K(Y(e)),type:"application/ld+json"}]:[]}(e)),i},r.updateHelmet=function(t){var e,r=null,n=this.props.context.setHelmet;it.canUseDOM?(e=t,st&&cancelAnimationFrame(st),e.defer?st=requestAnimationFrame(function(){ut(e,function(){st=null})}):(ut(e),st=null)):Z&&(r=Z(t)),n(r)},r.emitChange=function(){var t,e=this,r=this.props.context,n=r.setApiData,i=(t=r.helmetInstances.get().map(function(t){var e=p({},t.props);return delete e.context,e}),{baseTag:H([T],t),bodyAttributes:N(A,t),defer:D(t,"defer"),encode:D(t,"encodeSpecialCharacters"),htmlAttributes:N(C,t),linkTags:R(O.LINK,[b,T],t),metaTags:R(O.META,["name","charset","http-equiv","property",v],t),noscriptTags:R(O.NOSCRIPT,[g],t),onChangeClientState:M(t),scriptTags:R(O.SCRIPT,["src",g],t),styleTags:R(O.STYLE,[y],t),title:L(t),titleAttributes:N("titleAttributes",t),prioritizeSeoTags:q(t,"prioritizeSeoTags")});this.props.context.webSiteId&&!this.props.context.apiData?function(t,e,r,n){try{var i=new k(e,n);return Promise.resolve(i.get(t+"__mm__"+r))}catch(t){return Promise.reject(t)}}(this.props.context.webSiteId,it.canUseDOM,this.props.path,this.props.context.authToken).then(function(t){if(t){n(t);var r=e.syncMeta(i,t);e.updateHelmet(r)}else e.updateHelmet(i)}).catch(function(t){return console.error(t)}):this.updateHelmet(i)},r.init=function(){this.rendered||(this.rendered=!0,this.props.context.helmetInstances.add(this),this.emitChange())},r.render=function(){return this.init(),null},e}(e.Component);lt.propTypes={context:rt.isRequired},lt.displayName="HelmetDispatcher";var ft=["children"],pt=["children"],dt=/*#__PURE__*/function(t){function e(){var e;return(e=t.call(this)||this).state={},e}d(e,t);var r=e.prototype;return r.shouldComponentUpdate=function(t){return!c.default(B(this.props,"helmetData"),B(t,"helmetData"))},r.mapNestedChildrenToProps=function(t,e){if(!e)return null;switch(t.type){case O.SCRIPT:case O.NOSCRIPT:return{innerHTML:e};case O.STYLE:return{cssText:e};default:throw new Error("<"+t.type+" /> elements are self-closing and can not contain children. Refer to our API for more information.")}},r.flattenArrayTypeChildren=function(t){var e,r=t.child,n=t.arrayTypeChildren;return p({},n,((e={})[r.type]=[].concat(n[r.type]||[],[p({},t.newChildProps,this.mapNestedChildrenToProps(r,t.nestedChildren))]),e))},r.mapObjectTypeChildren=function(t){var e,r,n=t.child,i=t.newProps,a=t.newChildProps,o=t.nestedChildren;switch(n.type){case O.TITLE:return p({},i,((e={})[n.type]=o,e.titleAttributes=p({},a),e));case O.BODY:return p({},i,{bodyAttributes:p({},a)});case O.HTML:return p({},i,{htmlAttributes:p({},a)});default:return p({},i,((r={})[n.type]=p({},a),r))}},r.mapArrayTypeChildrenToProps=function(t,e){var r=p({},e);return Object.keys(t).forEach(function(e){var n;r=p({},r,((n={})[e]=t[e],n))}),r},r.warnOnInvalidChildren=function(t,e){return l.default(E.some(function(e){return t.type===e}),"function"==typeof t.type?"You may be attempting to nest <Helmet> components within each other, which is not allowed. Refer to our API for more information.":"Only elements types "+E.join(", ")+" are allowed. Helmet does not support rendering <"+t.type+"> elements. Refer to our API for more information."),l.default(!e||"string"==typeof e||Array.isArray(e)&&!e.some(function(t){return"string"!=typeof t}),"Helmet expects a string as a child of <"+t.type+">. Did you forget to wrap your children in braces? ( <"+t.type+">{``}</"+t.type+"> ) Refer to our API for more information."),!0},r.mapChildrenToProps=function(t,e){var r=this,n={};return u.default.Children.forEach(t,function(t){if(t&&t.props){var i=t.props,a=i.children,o=m(i,ft),u=Object.keys(o).reduce(function(t,e){return t[j[e]||e]=o[e],t},{}),s=t.type;switch("symbol"==typeof s?s=s.toString():r.warnOnInvalidChildren(t,a),s){case O.FRAGMENT:e=r.mapChildrenToProps(a,e);break;case O.LINK:case O.META:case O.NOSCRIPT:case O.SCRIPT:case O.STYLE:n=r.flattenArrayTypeChildren({child:t,arrayTypeChildren:n,newChildProps:u,nestedChildren:a});break;default:e=r.mapObjectTypeChildren({child:t,newProps:e,newChildProps:u,nestedChildren:a})}}}),this.mapArrayTypeChildrenToProps(n,e)},r.mapDataToApi=function(t){var e,r;return p({},t,{title:null!=(e=null==(r=this.state.apiData)?void 0:r.meta.tag.title)?e:t.title})},r.render=function(){var t=this.props,e=t.children,r=m(t,pt),n=p({},r),i=r.helmetData;return e&&(n=this.mapChildrenToProps(e,n)),!i||i instanceof tt||(i=new tt(i.context,i.instances)),i?/*#__PURE__*/u.default.createElement(lt,p({},n,{context:i.value,helmetData:void 0})):/*#__PURE__*/u.default.createElement(et.Consumer,null,function(t){/*#__PURE__*/return u.default.createElement(lt,p({},n,{context:t}))})},e}(e.Component);dt.propTypes={base:s.default.object,bodyAttributes:s.default.object,children:s.default.oneOfType([s.default.arrayOf(s.default.node),s.default.node]),defaultTitle:s.default.string,defer:s.default.bool,encodeSpecialCharacters:s.default.bool,htmlAttributes:s.default.object,link:s.default.arrayOf(s.default.object),meta:s.default.arrayOf(s.default.object),noscript:s.default.arrayOf(s.default.object),onChangeClientState:s.default.func,script:s.default.arrayOf(s.default.object),style:s.default.arrayOf(s.default.object),title:s.default.string,titleAttributes:s.default.object,titleTemplate:s.default.string,prioritizeSeoTags:s.default.bool,helmetData:s.default.object},dt.defaultProps={defer:!0,encodeSpecialCharacters:!0,prioritizeSeoTags:!1},dt.displayName="Helmet",t.Helmet=dt,t.HelmetData=tt,t.HelmetProvider=it});
//# sourceMappingURL=index.umd.js.map
